#!/usr/bin/env node

let client = '../client'
let path = require('path')
let app = require('express')()
let serve_static = require('serve-static')
let credential = require('config').mqtt.credential
let config = require('config').server
let mongo = require('config').mongo
let http = require('http').Server(app)
let connection = require('../server/connection')

app.use('/', serve_static(path.resolve(__dirname, client)))

http.listen(config.port, () => {
  console.log('Server listening at port %d', config.port)
})

mqtt = connection.mqtt(credential)
connection.subscribe(mqtt)

socket = connection.socket(http)
connection.emit_start(socket)
connection.read_msg(mqtt,socket)


connection.mongoose(mongo.uri)



